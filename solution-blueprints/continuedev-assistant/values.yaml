# Copyright Â© Advanced Micro Devices, Inc., or its affiliates.
#
# SPDX-License-Identifier: MIT

metadata:
  annotations:
    pvc.silogen.ai/user-pvc-auto-create: "true"
    pvc.silogen.ai/user-pvc-size: "2Gi"
    pvc.silogen.ai/user-pvc-storage-class-name: "multinode"
    pvc.silogen.ai/user-pvc-uid: "{{ .Values.metadata.user_id }}"
  labels: {}
  project_id: default
  user_id: user
  workload_id: # defaults to the release name

image: rocm/pytorch:rocm7.0.2_ubuntu22.04_py3.10_pytorch_release_2.7.1
imagePullPolicy: Always
gpus: 1
memory_per_gpu: 128 # Gi
cpu_per_gpu: 4

env_vars:
  BUCKET_STORAGE_HOST: http://minio.minio-tenant-default.svc.cluster.local:80
  BUCKET_STORAGE_ACCESS_KEY:
    name: minio-credentials
    key: minio-access-key
  BUCKET_STORAGE_SECRET_KEY:
    name: minio-credentials
    key: minio-secret-key

storage:
  ephemeral:
    quantity: 128Gi
    storageClassName: mlstorage
    accessModes:
      - ReadWriteOnce
  dshm:
    sizeLimit: 16Gi

deployment:
  ports:
    http: 8080

# startupProbe - checks if the container has successfully started. It disables liveness and readiness probes until it succeeds, useful for slow-starting applications.
# livenessProbe - checks if the container is still alive. If it fails, Kubernetes restarts the container to recover from failure.
# readinessProbe - checks if the container is ready to serve traffic. If it fails, the container is removed from the service's endpoints but remains running.
# ref: https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/
startupProbe:
  httpGet:
    path: /healthz
    port: http
  failureThreshold: 60
  periodSeconds: 10
livenessProbe:
  httpGet:
    path: /healthz
    port: http
readinessProbe:
  httpGet:
    path: /healthz
    port: http

# kaiwo settings (if enabled, use kaiwo CRDs to have kaiwo operator manage the workload)
kaiwo:
  enabled: false

http_route:
  enabled: false

ingress:
  enabled: false

persistent_storage:
  enabled: false
  volumes:
    pvc-user:
      pvc_name: "pvc-{{ .Values.metadata.user_id }}"
      mount_path: "/workload/{{ .Values.metadata.user_id }}"


chat:
  defaultCompletionOptions:
    temperature: 0.6
    topP: 0.95
    topK: 20
    minP: 0
  llm:
    nameOverride: qwen3-32b
    image: "amdenterpriseai/aim-qwen-qwen3-32b:0.8.4"

    storage:
      ephemeral:
        storageClassName: mlstorage


autocomplete:  # Make a version of the LLM available for autocomplete. It can have extra values (e.g. thinking turned off.)
  enabled: true
  llm:
    nameOverride: qwen2-5-coder-7b
    image: "amdenterpriseai/aim-base:0.8"
    env_vars:
      AIM_MODEL_ID: "Qwen/Qwen2.5-Coder-7B"

    storage:
      ephemeral:
        storageClassName: mlstorage
  defaultCompletionOptions:
    temperature: 0.0
    maxTokens: 128
  autocompleteOptions:
    debounceDelay: 50
    modelTimeout: 2500
    maxPromptTokens: 8192
    onlyMyCode: true
